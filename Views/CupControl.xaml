<UserControl x:Class="CupMarker.Views.CupControl"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        
        xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit" 
        xmlns:resources="clr-namespace:CupMarker.Resources" 
        >
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <resources:InverseBoolToVisibilityConverter x:Key="InverseBoolToVis"/>
    </UserControl.Resources>


    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>

            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <Grid Grid.Row="1">
            <Grid.RowDefinitions>

                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <TextBlock Text="Preview Image:" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>
            <Border Background="{StaticResource CanvasBackgroundBrush}" Grid.Row="1"
                        CornerRadius="20"
                        Padding="10"
                    
                     >
                <Canvas  x:Name="PreviewCanvas" Background="{StaticResource CanvasBackgroundBrush}" Height="592" SizeChanged="PreviewCanvas_SizeChanged">

                    <TextBlock Text="{Binding HeightCupMarkString}"
                                FontSize="16"
                                Foreground="{StaticResource PlaceholderBrush}"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Visibility="{Binding HasOrderInfoLoaded, Converter={StaticResource BoolToVis}}"
                                Canvas.Right="0" 
                                Canvas.Top="0"/>

                    <TextBlock Text="{Binding CenterYMarkString}"
                                FontSize="16"
                                Foreground="{StaticResource PlaceholderBrush}"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Visibility="{Binding HasOrderInfoLoaded, Converter={StaticResource BoolToVis}}"
                                Canvas.Right="0" 
                                Canvas.Bottom="0"/>


                    <Grid Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Canvas}}"
                                Height="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType=Canvas}}">
                        <TextBlock Text="Preview will appear here"
                                FontSize="16"
                                Foreground="{StaticResource PlaceholderBrush}"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Visibility="{Binding HasOrderInfoLoaded, Converter={StaticResource InverseBoolToVis}}"/>
                    </Grid>

                    <Image Source="{Binding PreviewImage}" 

                                Width="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType=Canvas}}"
                                Canvas.Left="0" 
                                Canvas.Top="0"
                                Visibility="{Binding HasOrderInfoLoaded, Converter={StaticResource BoolToVis}}"/>


                    <Line X1="0" 
                                X2="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Canvas}}"
                                Y1="{Binding Y1, Mode=TwoWay}" 
                                Y2="{Binding Y1, Mode=TwoWay}"
                                Stroke="Red" StrokeThickness="2" Cursor="SizeNS"
                              
                                Visibility="{Binding HasOrderInfoLoaded, Converter={StaticResource BoolToVis}}"
                              />
                    <Line X1="0" 
                                X2="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Canvas}}"
                                Y1="{Binding Y1, Mode=TwoWay}" 
                                Y2="{Binding Y1, Mode=TwoWay}"
                                Stroke="Transparent" StrokeThickness="20" Cursor="SizeNS"
                                MouseLeftButtonDown="Line_MouseDown"
                                MouseLeftButtonUp="Line_MouseUp"
                                MouseMove="Line_MouseMove"
                                Tag="FirstLine"
                                Visibility="{Binding HasOrderInfoLoaded, Converter={StaticResource BoolToVis}}"
                                />


                    <Line X1="0" 
                              X2="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Canvas}}"
                              Y1="{Binding Y2, Mode=TwoWay}" 
                              Y2="{Binding Y2, Mode=TwoWay}" 
                              Stroke="Red" StrokeThickness="2" Cursor="SizeNS"
                              Visibility="{Binding HasOrderInfoLoaded, Converter={StaticResource BoolToVis}}"
                              />
                    <Line X1="0" 
                                X2="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Canvas}}"
                                Y1="{Binding Y2, Mode=TwoWay}" 
                                Y2="{Binding Y2, Mode=TwoWay}" 
                                Stroke="Transparent" StrokeThickness="20" Cursor="SizeNS"
                                MouseLeftButtonDown="Line_MouseDown"
                                MouseLeftButtonUp="Line_MouseUp"
                                MouseMove="Line_MouseMove"
                                Tag="SecondLine"
                                Visibility="{Binding HasOrderInfoLoaded, Converter={StaticResource BoolToVis}}"
                                />
                </Canvas>
            </Border>
        </Grid>

        <!-- RIGHT: Controls -->
        <StackPanel Grid.Row="1" Grid.Column="1" Margin="20,7,0,0" VerticalAlignment="Top" >
            <TextBlock Text="Preselected Codes:" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
            <ComboBox Height="30" SelectedIndex="0" Margin="0,0,0,10" SelectedValue="{Binding BarcodeSelected, Mode=TwoWay}" SelectedValuePath="Content">
                <ComboBoxItem IsEnabled="False" Foreground="Gray">Select a code...</ComboBoxItem>
                <ComboBoxItem>251105/ZUue7pjs</ComboBoxItem>
                <ComboBoxItem>251105/WEYlpwYu</ComboBoxItem>
                <ComboBoxItem>250825/Xslfyd1k</ComboBoxItem>
            </ComboBox>

            <TextBlock Text="Enter Code:" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
            <TextBox x:Name="BarcodeInput" Height="30" FontSize="18" Margin="0,0,0,10" Text="{Binding Barcode, Mode=TwoWay}" GotKeyboardFocus="BarcodeInput_GotKeyboardFocus" PreviewMouseLeftButtonDown="BarcodeInput_PreviewMouseLeftButtonDown"/>

            <Button x:Name="BtnGetSvg" Content="Get Images/SVG" 
                     Height="40" Command="{Binding GetOrderCommand}" />

            <StackPanel Visibility="{Binding HasOrderInfoLoaded, Converter={StaticResource BoolToVis}}">

                <Button x:Name="BtnStart" Content="Start"  
                         Height="40" Command="{Binding StartJobCommand}" Margin="0,50,0,0"/>

                <TextBlock x:Name="StatusText" Foreground="Gray" TextWrapping="Wrap" Margin="0,10,0,0"/>
            </StackPanel>
        </StackPanel>
    </Grid>
</UserControl>
